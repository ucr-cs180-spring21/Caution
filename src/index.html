<!DOCTYPE html>
 <html lang = "en">
 <head>
	 <meta charset = "UTF-8">
	 <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
	 <title>Caution</title>
 </head>
 	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
 	<script src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.13/css/jquery.dataTables.min.css">
	<link type="text/css" href="styling/style.css">
	<body>
		<h1>Caution!</h1>	 
		
		<div>
			<select multiple="multiple" class="multi-select" id="multi-select" onchange="updateFilters()">
				<option value="" disabled selected>Select filters</option>
				<option id="bump" value="bump">Bump</option>
				<option id="snow" value="snow">snow</option>
				<option id="humid" value="humid">Humidity</option>
				<option id="severity" value="severity">severity</option>
				<option id="timezone" value="timezone">timezone</option>
				<option id="city" value="city">city</option>
				<option id="airport" value="airport">airport</option>
				<option id="pressure" value="pressure">pressure</option>
				<option id="city" value="city">city</option>

				<!--<option id="year" value="year">year</option>
				<option id="month"value="month">month</option>
				<option id="day" value="day">day</option>
				<option id="startTime" value="startTime">startTime</option>
				<option id="endTime" value="endTime">endTime</option>
				<option id="state" value="state">state</option>
				<option id="county" value="county">county</option>
				<option id="zipcode" value="zipcode">zipcode</option>
				<option id="street" value="street">street</option>
				<option id="number" value="number">number</option>
				<option id="startLat" value="startLat">startLat</option>
				<option id="endLat" value="endLat">endLat</option>
				<option id="startLong" value="startLong">startLong</option>
				<option id="endLong" value="endLong">endLong</option>
				<option id="severity" value="severity">severity</option>
				<option id="bump" value="bump">bump</option>
				<option id="stop" value="stop">stop</option>
				<option id="signal" value="signal">signal</option>
				<option id="weather" value="weather">weather</option>
				<option id="humidity" value="humidity">humidity</option>-->
			</select>
		</div>

		<p id="hellow"></p>
		<button onclick="buttonClickedhello()">Hello!</button>

		<div class="button">
			<button type="button" onclick="updateTable()">Update</button>
			<button type="button" onclick="buttonClear()">Clear</button>
			<button type="button" onclick="">Export</button>
		</div>

		<div class="text-area" id="text-area">
			<table id="infotable" class="display" width="100%" cellspacing="0"></table>
		</div>
		
		<script src="/socket.io/socket.io.js"></script>
		<script>
			// Global variables
			var socket = io.connect();
			var selectedFilters = [];

			// Function executes immediately and displays which filters are selected
			window.onload = multiselectFeature(); 
			function multiselectFeature() {
				var selectTag = document.querySelector('select');
				filters = new Array(selectTag.length);
			
				selectTag.addEventListener('click', function(e) {
					// Initialize all the filters to be unselected 
					filters[e.target.index] = !filters[e.target.index];
					
					// If filter is selected, mark it
					for(var i = 0; i < filters.length; ++i) {
						selectTag.options[i].selected = filters[i];
					}
				})
			}


			// This function gets the filters that are selected
			function updateFilters() {
				// Convert all of the options to an array
				// Then, get an array of only the options that are selected
				// Then, get an array of the selected option values
				selectedFilters = Array.from(document.getElementById("multi-select").options).filter(function (option) {
					return option.selected;
				}).map(function (option) {
					return option.value;
				});
				console.log(selectedFilters)
			}


			// This function returns the names of the filters that were selected
			function getFilters() {
				return selectedFilters;
			}


			// When the update button is pressed, update the table
			function updateTable() {
				if(selectedFilters[0] == 'bump') {
					socket.emit('bump');
				}
				else if(selectedFilters[0] == 'snow') {
					socket.emit('snow');
				}
				else if(selectedFilters[0] == 'humid') {
					socket.emit('humid');
				}
				else if(selectedFilters[0] == 'severity') {
					socket.emit('severity');
				}
				else if(selectedFilters[0] == 'timezone') {
					socket.emit('timezone');
				}
				else if(selectedFilters[0] == 'city') {
					socket.emit('city');
				}
				else if(selectedFilters[0] == 'airport') {
					socket.emit('airport');
				}
				else if(selectedFilters[0] == 'pressure') {
					socket.emit('pressure');
				}
			}
			

			// Emits to the server
			function buttonClickedhello() {
				socket.emit('hello');
			}


			// Button is pressed clears the table
			function buttonClear() {
				socket.emit('clear');
			}


			// When the server sends, update the HTML
			socket.on('hello world', function(data){
				console.log("Hello World!");
				document.getElementById("hellow").innerHTML = 'Hello World!';
			});


			socket.on('empty', function(data){
				//method learned from: https://stackoverflow.com/questions/44127872/convert-array-of-objects-into-html-table-with-jquery-or-javascript
				var table = '<table>';
				table += '<thead>';
				table += '<tr>';
				testarr = ['ID', 'Source', 'TMC', 'Severity', 'Start_Time', 'End_Time', 'Start_Lat', 'Start_Lng', 'End_Lat', 
				'End_Lng', 'Distance(mi)', 'Description', 'Number', 'Street', 'Side', 'City', 'County', 'State', 'Zipcode', 'Country', 
				'Timezone', 'Airport_Code', 'Weather_Timestamp', 'Temperature(F)', 'Wind_Chill(F)', 'Humidity(%)', 'Pressure(in)', 'Visibility(mi)',
				'Wind_Direction', 'Wind_Speed(mph)', 'Precipitation(in)', 'Weather_Condition', 'Amenity', 'Bump', 'Crossing', 'Give_Way', 'Junction',
				'No_Exit', 'Railway', 'Roundabout', 'Station', 'Stop', 'Traffic_Calming', 'Traffic_Signal', 'Turning_Loop', 'Sunrise_Sunset', 'Civil_Twilight',
				'Nautical_Twilight', 'Astronomical_Twilight']
				
				for(var i in data[0]) {
					table += '<th>' + i + '</th>';
				}

				table += '</tr>';
				table += '<tbody>';
				for(var j = 0; j < data.length; j++){
					table += '<tr>';
					for(var k in data[j]){
					table += '<td>' + data[j][k] + '</td>';
					}
					table += '</tr>';
				}
				table += '</tbody>';
				table += '</table>';
				document.getElementById('infotable').innerHTML = table;
				$(document).ready(function() {
					$('#infotable').DataTable( {
						"pagingType": "full_numbers",
					} );
				} );
			});


			socket.on('senddata', function(data){
				console.log("Received Data");
				//method learned from: https://stackoverflow.com/questions/44127872/convert-array-of-objects-into-html-table-with-jquery-or-javascript
				var table = '<table>';
				table += '<thead>';
				table += '<tr>';
				testarr = ['ID', 'Source', 'TMC', 'Severity', 'Start_Time', 'End_Time', 'Start_Lat', 'Start_Lng', 'End_Lat', 
				'End_Lng', 'Distance(mi)', 'Description', 'Number', 'Street', 'Side', 'City', 'County', 'State', 'Zipcode', 'Country', 
				'Timezone', 'Airport_Code', 'Weather_Timestamp', 'Temperature(F)', 'Wind_Chill(F)', 'Humidity(%)', 'Pressure(in)', 'Visibility(mi)',
				'Wind_Direction', 'Wind_Speed(mph)', 'Precipitation(in)', 'Weather_Condition', 'Amenity', 'Bump', 'Crossing', 'Give_Way', 'Junction',
				'No_Exit', 'Railway', 'Roundabout', 'Station', 'Stop', 'Traffic_Calming', 'Traffic_Signal', 'Turning_Loop', 'Sunrise_Sunset', 'Civil_Twilight',
				'Nautical_Twilight', 'Astronomical_Twilight']
				
				// for(var i in data[0]) {
				// 	table += '<th>' + i + '</th>';
				// 	console.log(i);
				// }

				for(var i in testarr) {
					table += '<th>' + testarr[i] + '</th>';
				}

				table += '</tr>';
				table += '<tbody>';
				for(var j = 0; j < data.length; j++){
					table += '<tr>';
					for(var k in data[j]){
					table += '<td>' + data[j][k] + '</td>';
					}
					table += '</tr>';
				}
				table += '</tbody>';
				table += '</table>';
				document.getElementById('infotable').innerHTML = table;
				$(document).ready(function() {
					$('#infotable').DataTable( {
						"pagingType": "full_numbers",
					} );
				} );
			});
		</script>
	</body>
</html>
